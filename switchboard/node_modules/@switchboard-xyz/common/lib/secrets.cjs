"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DeleteSecretPayload = exports.RemoveMrEnclavePayload = exports.AddMrEnclavePayload = exports.CreateSecretPayload = exports.UpdateUserPayload = exports.SwitchboardSecrets = void 0;
const crypto_1 = require("crypto");
const lodash_1 = __importDefault(require("lodash"));
/**
 *  Default is to expire requests 30 seconds from now.
 */
const getDefaultRequestTimestamp = () => Math.floor(Date.now() / 1000) + 30;
class SwitchboardSecrets {
    url;
    constructor(url) {
        this.url = url ?? "https://api.secrets.switchboard.xyz";
    }
    async getUser(userPubkey, ciphersuite) {
        const url = `${this.url}/user/${userPubkey}/ciphersuite/${ciphersuite}`;
        const response = await fetch(url, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                "X-Signed-Header": Buffer.from((0, crypto_1.createHash)("sha256").update("test-sig").digest("hex")).toString("hex"),
            },
        });
        if (!response.ok) {
            throw new Error(`getUser failed: ${response.statusText}`);
        }
        const json = await response.json();
        return {
            ciphersuite: json.ciphersuite,
            user_pubkey: json.user_pubkey,
            created_at: new Date(json.created_at),
            updated_at: new Date(json.updated_at),
            contact_info: json.contact_info,
        };
    }
    createOrUpdateUserRequest(
    /**
     *  The address of the user.
     */
    userPubkey, 
    /**
     *  'ed25519' for Solana users, 'ethers' for EVM users.
     */
    ciphersuite, 
    /**
     *  Stringified contact info for the user.
     */
    contactInfo = "", 
    /**
     *  The timestamp that this request expires.
     *
     *  Default: now + 30 seconds.
     */
    expiryTimestamp = getDefaultRequestTimestamp()) {
        return new UpdateUserPayload(userPubkey, ciphersuite, contactInfo, expiryTimestamp);
    }
    async createOrUpdateUser(request, signature) {
        const url = `${this.url}/user`;
        const response = await fetch(url, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "X-Signed-Header": signature,
            },
            body: request.toString(),
        });
        if (!response.ok) {
            throw new Error(`createOrUpdateUser failed: ${response.statusText}`);
        }
    }
    async getUserSecrets(userPubkey, ciphersuite) {
        const url = `${this.url}/user/${userPubkey}/ciphersuite/${ciphersuite}/secrets`;
        const response = await fetch(url, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                "X-Signed-Header": Buffer.from((0, crypto_1.createHash)("sha256").update("test-sig").digest("hex")).toString("hex"),
            },
        });
        if (!response.ok) {
            throw new Error(`getUserSecrets failed: ${response.statusText}`);
        }
        const json = await response.json();
        return lodash_1.default.isArray(json)
            ? json
                .map((item) => ({
                secret: item.secret,
                secret_name: item.secret_name,
                created_at: new Date(item.created_at),
                updated_at: new Date(item.updated_at),
                whitelist: lodash_1.default.isArray(item.whitelisted_mrenclaves)
                    ? item.whitelisted_mrenclaves.filter((val) => !!val)
                    : [],
            }))
                .sort((a, b) => b.updated_at.getTime() - a.updated_at.getTime())
            : [];
    }
    createSecretRequest(
    /**
     *  The address of the user.
     */
    userPubkey, 
    /**
     *  'ed25519' for Solana users, 'ethers' for EVM users.
     */
    ciphersuite, 
    /**
     *  The key of the secret.
     *
     *  Keys must be unique per user.
     */
    secretName, 
    /**
     *  The value of the secret.
     */
    secretValue, 
    /**
     *  The timestamp that this request expires.
     *
     *  Default: now + 30 seconds.
     */
    expiryTimestamp = getDefaultRequestTimestamp()) {
        return new CreateSecretPayload(userPubkey, ciphersuite, secretName, secretValue, expiryTimestamp);
    }
    async createSecret(request, signature) {
        const url = `${this.url}/secret`;
        const response = await fetch(url, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "X-Signed-Header": signature,
            },
            body: request.toString(),
        });
        if (!response.ok) {
            throw new Error(`createSecret failed: ${response.statusText}`);
        }
    }
    createAddMrEnclaveRequest(
    /**
     *  The address of the user.
     */
    userPubkey, 
    /**
     *  'ed25519' for Solana users, 'ethers' for EVM users.
     */
    ciphersuite, 
    /**
     *  The MrEnclave value to add.
     */
    mrEnclave, 
    /**
     *  The names of the secrets to whitelist the MrEnclave value for.
     */
    secretNames, 
    /**
     *  The timestamp that this request expires.
     *
     *  Default: now + 30 seconds.
     */
    expiryTimestamp = getDefaultRequestTimestamp()) {
        return new AddMrEnclavePayload(userPubkey, ciphersuite, mrEnclave, secretNames, expiryTimestamp);
    }
    async addMrEnclave(request, signature) {
        const url = `${this.url}/mrenclave/whitelist`;
        const response = await fetch(url, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "X-Signed-Header": signature,
            },
            body: request.toString(),
        });
        if (!response.ok) {
            throw new Error(`addMrEnclave failed: ${response.statusText}`);
        }
    }
    createRemoveMrEnclaveRequest(
    /**
     *  The address of the user.
     */
    userPubkey, 
    /**
     *  'ed25519' for Solana users, 'ethers' for EVM users.
     */
    ciphersuite, 
    /**
     *  The mrEnclave value to remove.
     */
    mrEnclave, 
    /**
     *  The timestamp that this request expires.
     *
     *  Default: now + 30 seconds.
     */
    expiryTimestamp = getDefaultRequestTimestamp()) {
        return new RemoveMrEnclavePayload(userPubkey, ciphersuite, mrEnclave, expiryTimestamp);
    }
    async removeMrEnclave(request, signature) {
        const url = `${this.url}/mrenclave/whitelist`;
        const response = await fetch(url, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "X-Signed-Header": signature,
            },
            body: request.toString(),
        });
        if (!response.ok) {
            throw new Error(`removeMrEnclave failed: ${response.statusText}`);
        }
    }
    createDeleteSecretRequest(
    /**
     *  The address of the user.
     */
    userPubkey, 
    /**
     *  'ed25519' for Solana users, 'ethers' for EVM users.
     */
    ciphersuite, 
    /**
     *  The name fo the secret to delete.
     */
    secretName, 
    /**
     *  The timestamp that this request expires.
     *
     *  Default: now + 30 seconds.
     */
    expiryTimestamp = getDefaultRequestTimestamp()) {
        return new DeleteSecretPayload(userPubkey, ciphersuite, secretName, expiryTimestamp);
    }
    async deleteSecret(request, signature) {
        const url = `${this.url}/secret`;
        const response = await fetch(url, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json",
                "X-Signed-Header": signature,
            },
            body: request.toString(),
        });
        if (!response.ok) {
            throw new Error(`deleteSecret failed: ${response.statusText}`);
        }
    }
}
exports.SwitchboardSecrets = SwitchboardSecrets;
class UpdateUserPayload {
    user_pubkey;
    ciphersuite;
    contact_info;
    timestamp;
    constructor(user_pubkey, ciphersuite, contact_info, timestamp) {
        this.user_pubkey = user_pubkey;
        this.ciphersuite = ciphersuite;
        this.contact_info = contact_info;
        this.timestamp = timestamp;
    }
    static from(obj) {
        return new UpdateUserPayload(obj.user_pubkey, obj.ciphersuite, obj.contact_info, obj.timestamp);
    }
    toJSON() {
        return {
            user_pubkey: this.user_pubkey,
            ciphersuite: this.ciphersuite,
            contact_info: this.contact_info,
            timestamp: this.timestamp,
        };
    }
    toString() {
        return JSON.stringify(this.toJSON());
    }
    toEncodedMessage() {
        return Buffer.from((0, crypto_1.createHash)("sha256").update(this.toString()).digest("hex"));
    }
}
exports.UpdateUserPayload = UpdateUserPayload;
class CreateSecretPayload {
    user_pubkey;
    ciphersuite;
    secret_name;
    secret;
    timestamp;
    constructor(user_pubkey, ciphersuite, secret_name, secret, timestamp) {
        this.user_pubkey = user_pubkey;
        this.ciphersuite = ciphersuite;
        this.secret_name = secret_name;
        this.secret = secret;
        this.timestamp = timestamp;
    }
    static from(obj) {
        return new CreateSecretPayload(obj.user_pubkey, obj.ciphersuite, obj.secret_name, obj.secret, obj.timestamp);
    }
    toJSON() {
        return {
            user_pubkey: this.user_pubkey,
            ciphersuite: this.ciphersuite,
            secret: this.secret,
            secret_name: this.secret_name,
            timestamp: this.timestamp,
        };
    }
    toString() {
        return JSON.stringify(this.toJSON());
    }
    toEncodedMessage() {
        return Buffer.from((0, crypto_1.createHash)("sha256").update(this.toString()).digest("hex"));
    }
}
exports.CreateSecretPayload = CreateSecretPayload;
class AddMrEnclavePayload {
    user_pubkey;
    ciphersuite;
    mr_enclave;
    secret_names;
    timestamp;
    constructor(user_pubkey, ciphersuite, mr_enclave, secret_names, timestamp) {
        this.user_pubkey = user_pubkey;
        this.ciphersuite = ciphersuite;
        this.mr_enclave = mr_enclave;
        this.secret_names = secret_names;
        this.timestamp = timestamp;
    }
    static from(obj) {
        return new AddMrEnclavePayload(obj.user_pubkey, obj.ciphersuite, obj.mr_enclave, obj.secret_names, obj.timestamp);
    }
    toJSON() {
        return {
            user_pubkey: this.user_pubkey,
            ciphersuite: this.ciphersuite,
            mr_enclave: this.mr_enclave,
            secret_names: this.secret_names,
            timestamp: this.timestamp,
        };
    }
    toString() {
        return JSON.stringify(this.toJSON());
    }
    toEncodedMessage() {
        return Buffer.from((0, crypto_1.createHash)("sha256").update(this.toString()).digest("hex"));
    }
}
exports.AddMrEnclavePayload = AddMrEnclavePayload;
class RemoveMrEnclavePayload {
    user_pubkey;
    ciphersuite;
    mr_enclave;
    timestamp;
    constructor(user_pubkey, ciphersuite, mr_enclave, timestamp) {
        this.user_pubkey = user_pubkey;
        this.ciphersuite = ciphersuite;
        this.mr_enclave = mr_enclave;
        this.timestamp = timestamp;
    }
    static from(obj) {
        return new RemoveMrEnclavePayload(obj.user_pubkey, obj.ciphersuite, obj.mr_enclave, obj.timestamp);
    }
    toJSON() {
        return {
            user_pubkey: this.user_pubkey,
            ciphersuite: this.ciphersuite,
            mr_enclave: this.mr_enclave,
            timestamp: this.timestamp,
        };
    }
    toString() {
        return JSON.stringify(this.toJSON());
    }
    toEncodedMessage() {
        return Buffer.from((0, crypto_1.createHash)("sha256").update(this.toString()).digest("hex"));
    }
}
exports.RemoveMrEnclavePayload = RemoveMrEnclavePayload;
class DeleteSecretPayload {
    user_pubkey;
    ciphersuite;
    secret_name;
    timestamp;
    constructor(user_pubkey, ciphersuite, secret_name, timestamp) {
        this.user_pubkey = user_pubkey;
        this.ciphersuite = ciphersuite;
        this.secret_name = secret_name;
        this.timestamp = timestamp;
    }
    static from(obj) {
        return new DeleteSecretPayload(obj.user_pubkey, obj.ciphersuite, obj.secret_name, obj.timestamp);
    }
    toJSON() {
        return {
            user_pubkey: this.user_pubkey,
            ciphersuite: this.ciphersuite,
            secret_name: this.secret_name,
            timestamp: this.timestamp,
        };
    }
    toString() {
        return JSON.stringify(this.toJSON());
    }
    toEncodedMessage() {
        return Buffer.from((0, crypto_1.createHash)("sha256").update(this.toString()).digest("hex"));
    }
}
exports.DeleteSecretPayload = DeleteSecretPayload;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VjcmV0cy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9zZWNyZXRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLG1DQUFvQztBQUNwQyxvREFBdUI7QUFFdkI7O0dBRUc7QUFDSCxNQUFNLDBCQUEwQixHQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztBQWtCNUUsTUFBYSxrQkFBa0I7SUFDcEIsR0FBRyxDQUFTO0lBQ3JCLFlBQW1CLEdBQVk7UUFDN0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLElBQUkscUNBQXFDLENBQUM7SUFDMUQsQ0FBQztJQUVNLEtBQUssQ0FBQyxPQUFPLENBQ2xCLFVBQWtCLEVBQ2xCLFdBQW1CO1FBRW5CLE1BQU0sR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsU0FBUyxVQUFVLGdCQUFnQixXQUFXLEVBQUUsQ0FBQztRQUN4RSxNQUFNLFFBQVEsR0FBRyxNQUFNLEtBQUssQ0FBQyxHQUFHLEVBQUU7WUFDaEMsTUFBTSxFQUFFLEtBQUs7WUFDYixPQUFPLEVBQUU7Z0JBQ1AsY0FBYyxFQUFFLGtCQUFrQjtnQkFDbEMsaUJBQWlCLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FDNUIsSUFBQSxtQkFBVSxFQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQ3RELENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQzthQUNsQjtTQUNGLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDakIsTUFBTSxJQUFJLEtBQUssQ0FBQyxtQkFBbUIsUUFBUSxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUM7UUFDNUQsQ0FBQztRQUVELE1BQU0sSUFBSSxHQUFHLE1BQU0sUUFBUSxD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QUM7SUFFRyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQXlCO1FBQzFDLE9BQU8sSUFBSSxtQkFBbUIsQ0FDNUIsR0FBRyxDQUFDLFdBQVcsRUFDZixHQUFHLENBQUMsV0FBVyxFQUNmLEdBQUcsQ0FBQyxXQUFXLEVBQ2YsR0FBRyxDQUFDLFNBQVMsQ0FDZCxDQUFDO0lBQ0osQ0FBQztJQUVNLE1BQU07UUFDWCxPQUFPO1lBQ0wsV0FBVyxFQUFFLElBQUksQ0FBQyxXQUFXO1lBQzdCLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVztZQUM3QixXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7WUFDN0IsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTO1NBQzFCLENBQUM7SUFDSixDQUFDO0lBRU0sUUFBUTtRQUNiLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBRU0sZ0JBQWdCO1FBQ3JCLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FDaEIsSUFBQSxtQkFBVSxFQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQzNELENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFuQ0Qsa0RBbUNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlSGFzaCB9IGZyb20gXCJjcnlwdG9cIjtcbmltcG9ydCBfIGZyb20gXCJsb2Rhc2hcIjtcblxuLyoqXG4gKiAgRGVmYXVsdCBpcyB0byBleHBpcmUgcmVxdWVzdHMgMzAgc2Vjb25kcyBmcm9tIG5vdy5cbiAqL1xuY29uc3QgZ2V0RGVmYXVsdFJlcXVlc3RUaW1lc3RhbXAgPSAoKSA9PiBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKSArIDMwO1xuXG5leHBvcnQgdHlwZSBTZWNyZXRzQXBpVXNlciA9IHtcbiAgY2lwaGVyc3VpdGU6IFwiZWQyNTUxOVwiO1xuICB1c2VyX3B1YmtleTogc3RyaW5nO1xuICBjcmVhdGVkX2F0OiBEYXRlO1xuICB1cGRhdGVkX2F0OiBEYXRlO1xuICBjb250YWN0X2luZm86IHN0cmluZztcbn07XG5cbmV4cG9ydCB0eXBlIFNlY3JldHNBcGlTZWNyZXQgPSB7XG4gIGNyZWF0ZWRfYXQ6IERhdGU7XG4gIHVwZGF0ZWRfYXQ6IERhdGU7XG4gIHNlY3JldDogc3RyaW5nO1xuICBzZWNyZXRfbmFtZTogc3RyaW5nO1xuICB3aGl0ZWxpc3Q6IHN0cmluZ1tdO1xufTtcblxuZXhwb3J0IGNsYXNzIFN3aXRjaGJvYXJkU2VjcmV0cyB7XG4gIHJlYWRvbmx5IHVybDogc3RyaW5nO1xuICBwdWJsaWMgY29uc3RydWN0b3IodXJsPzogc3RyaW5nKSB7XG4gICAgdGhpcy51cmwgPSB1cmwgPz8gXCJodHRwczovL2FwaS5zZWNyZXRzLnN3aXRjaGJvYXJkLnh5elwiO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGdldFVzZXIoXG4gICAgdXNlclB1YmtleTogc3RyaW5nLFxuICAgIGNpcGhlcnN1aXRlOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxTZWNyZXRzQXBpVXNlcj4ge1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMudXJsfS91c2VyLyR7dXNlclB1YmtleX0vY2lwaGVyc3VpdGUvJHtjaXBoZXJzdWl0ZX1gO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBcIlgtU2lnbmVkLUhlYWRlclwiOiBCdWZmZXIuZnJvbShcbiAgICAgICAgICBjcmVhdGVIYXNoKFwic2hhMjU2XCIpLnVwZGF0ZShcInRlc3Qtc2lnXCIpLmRpZ2VzdChcImhleFwiKVxuICAgICAgICApLnRvU3RyaW5nKFwiaGV4XCIpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYGdldFVzZXIgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgfVxuXG4gICAgY29uc3QganNvbiA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICByZXR1cm4ge1xuICAgICAgY2lwaGVyc3VpdGU6IGpzb24uY2lwaGVyc3VpdGUsXG4gICAgICB1c2VyX3B1YmtleToganNvbi51c2VyX3B1YmtleSxcbiAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKGpzb24uY3JlYXRlZF9hdCksXG4gICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZShqc29uLnVwZGF0ZWRfYXQpLFxuICAgICAgY29udGFjdF9pbmZvOiBqc29uLmNvbnRhY3RfaW5mbyxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZU9yVXBkYXRlVXNlclJlcXVlc3QoXG4gICAgLyoqXG4gICAgICogIFRoZSBhZGRyZXNzIG9mIHRoZSB1c2VyLlxuICAgICAqL1xuICAgIHVzZXJQdWJrZXk6IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiAgJ2VkMjU1MTknIGZvciBTb2xhbmEgdXNlcnMsICdldGhlcnMnIGZvciBFVk0gdXNlcnMuXG4gICAgICovXG4gICAgY2lwaGVyc3VpdGU6IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiAgU3RyaW5naWZpZWQgY29udGFjdCBpbmZvIGZvciB0aGUgdXNlci5cbiAgICAgKi9cbiAgICBjb250YWN0SW5mbyA9IFwiXCIsXG4gICAgLyoqXG4gICAgICogIFRoZSB0aW1lc3RhbXAgdGhhdCB0aGlzIHJlcXVlc3QgZXhwaXJlcy5cbiAgICAgKlxuICAgICAqICBEZWZhdWx0OiBub3cgKyAzMCBzZWNvbmRzLlxuICAgICAqL1xuICAgIGV4cGlyeVRpbWVzdGFtcCA9IGdldERlZmF1bHRSZXF1ZXN0VGltZXN0YW1wKClcbiAgKTogVXBkYXRlVXNlclBheWxvYWQge1xuICAgIHJldHVybiBuZXcgVXBkYXRlVXNlclBheWxvYWQoXG4gICAgICB1c2VyUHVia2V5LFxuICAgICAgY2lwaGVyc3VpdGUsXG4gICAgICBjb250YWN0SW5mbyxcbiAgICAgIGV4cGlyeVRpbWVzdGFtcFxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgY3JlYXRlT3JVcGRhdGVVc2VyKFxuICAgIHJlcXVlc3Q6IFVwZGF0ZVVzZXJQYXlsb2FkLFxuICAgIHNpZ25hdHVyZTogc3RyaW5nXG4gICkge1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMudXJsfS91c2VyYDtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgXCJYLVNpZ25lZC1IZWFkZXJcIjogc2lnbmF0dXJlLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IHJlcXVlc3QudG9TdHJpbmcoKSxcbiAgICB9KTtcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYGNyZWF0ZU9yVXBkYXRlVXNlciBmYWlsZWQ6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0VXNlclNlY3JldHMoXG4gICAgdXNlclB1YmtleTogc3RyaW5nLFxuICAgIGNpcGhlcnN1aXRlOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxTZWNyZXRzQXBpU2VjcmV0W10+IHtcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLnVybH0vdXNlci8ke3VzZXJQdWJrZXl9L2NpcGhlcnN1aXRlLyR7Y2lwaGVyc3VpdGV9L3NlY3JldHNgO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBcIlgtU2lnbmVkLUhlYWRlclwiOiBCdWZmZXIuZnJvbShcbiAgICAgICAgICBjcmVhdGVIYXNoKFwic2hhMjU2XCIpLnVwZGF0ZShcInRlc3Qtc2lnXCIpLmRpZ2VzdChcImhleFwiKVxuICAgICAgICApLnRvU3RyaW5nKFwiaGV4XCIpLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYGdldFVzZXJTZWNyZXRzIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgIH1cblxuICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgcmV0dXJuIF8uaXNBcnJheShqc29uKVxuICAgICAgPyBqc29uXG4gICAgICAgICAgLm1hcDxTZWNyZXRzQXBpU2VjcmV0PigoaXRlbSkgPT4gKHtcbiAgICAgICAgICAgIHNlY3JldDogaXRlbS5zZWNyZXQsXG4gICAgICAgICAgICBzZWNyZXRfbmFtZTogaXRlbS5zZWNyZXRfbmFtZSxcbiAgICAgICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKGl0ZW0uY3JlYXRlZF9hdCksXG4gICAgICAgICAgICB1cGRhdGVkX2F0OiBuZXcgRGF0ZShpdGVtLnVwZGF0ZWRfYXQpLFxuICAgICAgICAgICAgd2hpdGVsaXN0OiBfLmlzQXJyYXkoaXRlbS53aGl0ZWxpc3RlZF9tcmVuY2xhdmVzKVxuICAgICAgICAgICAgICA/IGl0ZW0ud2hpdGVsaXN0ZWRfbXJlbmNsYXZlcy5maWx0ZXIoKHZhbDogc3RyaW5nKSA9PiAhIXZhbClcbiAgICAgICAgICAgICAgOiBbXSxcbiAgICAgICAgICB9KSlcbiAgICAgICAgICAuc29ydCgoYSwgYikgPT4gYi51cGRhdGVkX2F0LmdldFRpbWUoKSAtIGEudXBkYXRlZF9hdC5nZXRUaW1lKCkpXG4gICAgICA6IFtdO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZVNlY3JldFJlcXVlc3QoXG4gICAgLyoqXG4gICAgICogIFRoZSBhZGRyZXNzIG9mIHRoZSB1c2VyLlxuICAgICAqL1xuICAgIHVzZXJQdWJrZXk6IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiAgJ2VkMjU1MTknIGZvciBTb2xhbmEgdXNlcnMsICdldGhlcnMnIGZvciBFVk0gdXNlcnMuXG4gICAgICovXG4gICAgY2lwaGVyc3VpdGU6IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiAgVGhlIGtleSBvZiB0aGUgc2VjcmV0LlxuICAgICAqXG4gICAgICogIEtleXMgbXVzdCBiZSB1bmlxdWUgcGVyIHVzZXIuXG4gICAgICovXG4gICAgc2VjcmV0TmFtZTogc3RyaW5nLFxuICAgIC8qKlxuICAgICAqICBUaGUgdmFsdWUgb2YgdGhlIHNlY3JldC5cbiAgICAgKi9cbiAgICBzZWNyZXRWYWx1ZTogc3RyaW5nLFxuICAgIC8qKlxuICAgICAqICBUaGUgdGltZXN0YW1wIHRoYXQgdGhpcyByZXF1ZXN0IGV4cGlyZXMuXG4gICAgICpcbiAgICAgKiAgRGVmYXVsdDogbm93ICsgMzAgc2Vjb25kcy5cbiAgICAgKi9cbiAgICBleHBpcnlUaW1lc3RhbXAgPSBnZXREZWZhdWx0UmVxdWVzdFRpbWVzdGFtcCgpXG4gICk6IENyZWF0ZVNlY3JldFBheWxvYWQge1xuICAgIHJldHVybiBuZXcgQ3JlYXRlU2VjcmV0UGF5bG9hZChcbiAgICAgIHVzZXJQdWJrZXksXG4gICAgICBjaXBoZXJzdWl0ZSxcbiAgICAgIHNlY3JldE5hbWUsXG4gICAgICBzZWNyZXRWYWx1ZSxcbiAgICAgIGV4cGlyeVRpbWVzdGFtcFxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgY3JlYXRlU2VjcmV0KHJlcXVlc3Q6IENyZWF0ZVNlY3JldFBheWxvYWQsIHNpZ25hdHVyZTogc3RyaW5nKSB7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy51cmx9L3NlY3JldGA7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIFwiWC1TaWduZWQtSGVhZGVyXCI6IHNpZ25hdHVyZSxcbiAgICAgIH0sXG4gICAgICBib2R5OiByZXF1ZXN0LnRvU3RyaW5nKCksXG4gICAgfSk7XG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBjcmVhdGVTZWNyZXQgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNyZWF0ZUFkZE1yRW5jbGF2ZVJlcXVlc3QoXG4gICAgLyoqXG4gICAgICogIFRoZSBhZGRyZXNzIG9mIHRoZSB1c2VyLlxuICAgICAqL1xuICAgIHVzZXJQdWJrZXk6IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiAgJ2VkMjU1MTknIGZvciBTb2xhbmEgdXNlcnMsICdldGhlcnMnIGZvciBFVk0gdXNlcnMuXG4gICAgICovXG4gICAgY2lwaGVyc3VpdGU6IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiAgVGhlIE1yRW5jbGF2ZSB2YWx1ZSB0byBhZGQuXG4gICAgICovXG4gICAgbXJFbmNsYXZlOiBzdHJpbmcsXG4gICAgLyoqXG4gICAgICogIFRoZSBuYW1lcyBvZiB0aGUgc2VjcmV0cyB0byB3aGl0ZWxpc3QgdGhlIE1yRW5jbGF2ZSB2YWx1ZSBmb3IuXG4gICAgICovXG4gICAgc2VjcmV0TmFtZXM6IHN0cmluZ1tdLFxuICAgIC8qKlxuICAgICAqICBUaGUgdGltZXN0YW1wIHRoYXQgdGhpcyByZXF1ZXN0IGV4cGlyZXMuXG4gICAgICpcbiAgICAgKiAgRGVmYXVsdDogbm93ICsgMzAgc2Vjb25kcy5cbiAgICAgKi9cbiAgICBleHBpcnlUaW1lc3RhbXAgPSBnZXREZWZhdWx0UmVxdWVzdFRpbWVzdGFtcCgpXG4gICk6IEFkZE1yRW5jbGF2ZVBheWxvYWQge1xuICAgIHJldHVybiBuZXcgQWRkTXJFbmNsYXZlUGF5bG9hZChcbiAgICAgIHVzZXJQdWJrZXksXG4gICAgICBjaXBoZXJzdWl0ZSxcbiAgICAgIG1yRW5jbGF2ZSxcbiAgICAgIHNlY3JldE5hbWVzLFxuICAgICAgZXhwaXJ5VGltZXN0YW1wXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBhZGRNckVuY2xhdmUocmVxdWVzdDogQWRkTXJFbmNsYXZlUGF5bG9hZCwgc2lnbmF0dXJlOiBzdHJpbmcpIHtcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLnVybH0vbXJlbmNsYXZlL3doaXRlbGlzdGA7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIFwiWC1TaWduZWQtSGVhZGVyXCI6IHNpZ25hdHVyZSxcbiAgICAgIH0sXG4gICAgICBib2R5OiByZXF1ZXN0LnRvU3RyaW5nKCksXG4gICAgfSk7XG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBhZGRNckVuY2xhdmUgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNyZWF0ZVJlbW92ZU1yRW5jbGF2ZVJlcXVlc3QoXG4gICAgLyoqXG4gICAgICogIFRoZSBhZGRyZXNzIG9mIHRoZSB1c2VyLlxuICAgICAqL1xuICAgIHVzZXJQdWJrZXk6IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiAgJ2VkMjU1MTknIGZvciBTb2xhbmEgdXNlcnMsICdldGhlcnMnIGZvciBFVk0gdXNlcnMuXG4gICAgICovXG4gICAgY2lwaGVyc3VpdGU6IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiAgVGhlIG1yRW5jbGF2ZSB2YWx1ZSB0byByZW1vdmUuXG4gICAgICovXG4gICAgbXJFbmNsYXZlOiBzdHJpbmcsXG4gICAgLyoqXG4gICAgICogIFRoZSB0aW1lc3RhbXAgdGhhdCB0aGlzIHJlcXVlc3QgZXhwaXJlcy5cbiAgICAgKlxuICAgICAqICBEZWZhdWx0OiBub3cgKyAzMCBzZWNvbmRzLlxuICAgICAqL1xuICAgIGV4cGlyeVRpbWVzdGFtcCA9IGdldERlZmF1bHRSZXF1ZXN0VGltZXN0YW1wKClcbiAgKTogUmVtb3ZlTXJFbmNsYXZlUGF5bG9hZCB7XG4gICAgcmV0dXJuIG5ldyBSZW1vdmVNckVuY2xhdmVQYXlsb2FkKFxuICAgICAgdXNlclB1YmtleSxcbiAgICAgIGNpcGhlcnN1aXRlLFxuICAgICAgbXJFbmNsYXZlLFxuICAgICAgZXhwaXJ5VGltZXN0YW1wXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyByZW1vdmVNckVuY2xhdmUoXG4gICAgcmVxdWVzdDogUmVtb3ZlTXJFbmNsYXZlUGF5bG9hZCxcbiAgICBzaWduYXR1cmU6IHN0cmluZ1xuICApIHtcbiAgICBjb25zdCB1cmwgPSBgJHt0aGlzLnVybH0vbXJlbmNsYXZlL3doaXRlbGlzdGA7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwsIHtcbiAgICAgIG1ldGhvZDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIFwiWC1TaWduZWQtSGVhZGVyXCI6IHNpZ25hdHVyZSxcbiAgICAgIH0sXG4gICAgICBib2R5OiByZXF1ZXN0LnRvU3RyaW5nKCksXG4gICAgfSk7XG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGByZW1vdmVNckVuY2xhdmUgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGNyZWF0ZURlbGV0ZVNlY3JldFJlcXVlc3QoXG4gICAgLyoqXG4gICAgICogIFRoZSBhZGRyZXNzIG9mIHRoZSB1c2VyLlxuICAgICAqL1xuICAgIHVzZXJQdWJrZXk6IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiAgJ2VkMjU1MTknIGZvciBTb2xhbmEgdXNlcnMsICdldGhlcnMnIGZvciBFVk0gdXNlcnMuXG4gICAgICovXG4gICAgY2lwaGVyc3VpdGU6IHN0cmluZyxcbiAgICAvKipcbiAgICAgKiAgVGhlIG5hbWUgZm8gdGhlIHNlY3JldCB0byBkZWxldGUuXG4gICAgICovXG4gICAgc2VjcmV0TmFtZTogc3RyaW5nLFxuICAgIC8qKlxuICAgICAqICBUaGUgdGltZXN0YW1wIHRoYXQgdGhpcyByZXF1ZXN0IGV4cGlyZXMuXG4gICAgICpcbiAgICAgKiAgRGVmYXVsdDogbm93ICsgMzAgc2Vjb25kcy5cbiAgICAgKi9cbiAgICBleHBpcnlUaW1lc3RhbXAgPSBnZXREZWZhdWx0UmVxdWVzdFRpbWVzdGFtcCgpXG4gICk6IERlbGV0ZVNlY3JldFBheWxvYWQge1xuICAgIHJldHVybiBuZXcgRGVsZXRlU2VjcmV0UGF5bG9hZChcbiAgICAgIHVzZXJQdWJrZXksXG4gICAgICBjaXBoZXJzdWl0ZSxcbiAgICAgIHNlY3JldE5hbWUsXG4gICAgICBleHBpcnlUaW1lc3RhbXBcbiAgICApO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGRlbGV0ZVNlY3JldChyZXF1ZXN0OiBEZWxldGVTZWNyZXRQYXlsb2FkLCBzaWduYXR1cmU6IHN0cmluZykge1xuICAgIGNvbnN0IHVybCA9IGAke3RoaXMudXJsfS9zZWNyZXRgO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBcIlgtU2lnbmVkLUhlYWRlclwiOiBzaWduYXR1cmUsXG4gICAgICB9LFxuICAgICAgYm9keTogcmVxdWVzdC50b1N0cmluZygpLFxuICAgIH0pO1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgZGVsZXRlU2VjcmV0IGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElVcGRhdGVVc2VyUGF5bG9hZCB7XG4gIHVzZXJfcHVia2V5OiBzdHJpbmc7XG4gIGNpcGhlcnN1aXRlOiBzdHJpbmc7XG4gIGNvbnRhY3RfaW5mbzogc3RyaW5nO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIFVwZGF0ZVVzZXJQYXlsb2FkIGltcGxlbWVudHMgSVVwZGF0ZVVzZXJQYXlsb2FkIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKFxuICAgIHJlYWRvbmx5IHVzZXJfcHVia2V5OiBzdHJpbmcsXG4gICAgcmVhZG9ubHkgY2lwaGVyc3VpdGU6IHN0cmluZyxcbiAgICByZWFkb25seSBjb250YWN0X2luZm86IHN0cmluZyxcbiAgICByZWFkb25seSB0aW1lc3RhbXA6IG51bWJlclxuICApIHt9XG5cbiAgcHVibGljIHN0YXRpYyBmcm9tKG9iajogSVVwZGF0ZVVzZXJQYXlsb2FkKTogVXBkYXRlVXNlclBheWxvYWQge1xuICAgIHJldHVybiBuZXcgVXBkYXRlVXNlclBheWxvYWQoXG4gICAgICBvYmoudXNlcl9wdWJrZXksXG4gICAgICBvYmouY2lwaGVyc3VpdGUsXG4gICAgICBvYmouY29udGFjdF9pbmZvLFxuICAgICAgb2JqLnRpbWVzdGFtcFxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgdG9KU09OKCk6IElVcGRhdGVVc2VyUGF5bG9hZCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXJfcHVia2V5OiB0aGlzLnVzZXJfcHVia2V5LFxuICAgICAgY2lwaGVyc3VpdGU6IHRoaXMuY2lwaGVyc3VpdGUsXG4gICAgICBjb250YWN0X2luZm86IHRoaXMuY29udGFjdF9pbmZvLFxuICAgICAgdGltZXN0YW1wOiB0aGlzLnRpbWVzdGFtcCxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCkpO1xuICB9XG5cbiAgcHVibGljIHRvRW5jb2RlZE1lc3NhZ2UoKTogQnVmZmVyIHtcbiAgICByZXR1cm4gQnVmZmVyLmZyb20oXG4gICAgICBjcmVhdGVIYXNoKFwic2hhMjU2XCIpLnVwZGF0ZSh0aGlzLnRvU3RyaW5nKCkpLmRpZ2VzdChcImhleFwiKVxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJQ3JlYXRlU2VjcmV0UGF5bG9hZCB7XG4gIHVzZXJfcHVia2V5OiBzdHJpbmc7XG4gIGNpcGhlcnN1aXRlOiBzdHJpbmc7XG4gIHNlY3JldF9uYW1lOiBzdHJpbmc7XG4gIHNlY3JldDogc3RyaW5nO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuZXhwb3J0IGNsYXNzIENyZWF0ZVNlY3JldFBheWxvYWQgaW1wbGVtZW50cyBJQ3JlYXRlU2VjcmV0UGF5bG9hZCB7XG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihcbiAgICByZWFkb25seSB1c2VyX3B1YmtleTogc3RyaW5nLFxuICAgIHJlYWRvbmx5IGNpcGhlcnN1aXRlOiBzdHJpbmcsXG4gICAgcmVhZG9ubHkgc2VjcmV0X25hbWU6IHN0cmluZyxcbiAgICByZWFkb25seSBzZWNyZXQ6IHN0cmluZyxcbiAgICByZWFkb25seSB0aW1lc3RhbXA6IG51bWJlclxuICApIHt9XG5cbiAgcHVibGljIHN0YXRpYyBmcm9tKG9iajogSUNyZWF0ZVNlY3JldFBheWxvYWQpOiBDcmVhdGVTZWNyZXRQYXlsb2FkIHtcbiAgICByZXR1cm4gbmV3IENyZWF0ZVNlY3JldFBheWxvYWQoXG4gICAgICBvYmoudXNlcl9wdWJrZXksXG4gICAgICBvYmouY2lwaGVyc3VpdGUsXG4gICAgICBvYmouc2VjcmV0X25hbWUsXG4gICAgICBvYmouc2VjcmV0LFxuICAgICAgb2JqLnRpbWVzdGFtcFxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgdG9KU09OKCk6IElDcmVhdGVTZWNyZXRQYXlsb2FkIHtcbiAgICByZXR1cm4ge1xuICAgICAgdXNlcl9wdWJrZXk6IHRoaXMudXNlcl9wdWJrZXksXG4gICAgICBjaXBoZXJzdWl0ZTogdGhpcy5jaXBoZXJzdWl0ZSxcbiAgICAgIHNlY3JldDogdGhpcy5zZWNyZXQsXG4gICAgICBzZWNyZXRfbmFtZTogdGhpcy5zZWNyZXRfbmFtZSxcbiAgICAgIHRpbWVzdGFtcDogdGhpcy50aW1lc3RhbXAsXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnRvSlNPTigpKTtcbiAgfVxuXG4gIHB1YmxpYyB0b0VuY29kZWRNZXNzYWdlKCk6IEJ1ZmZlciB7XG4gICAgcmV0dXJuIEJ1ZmZlci5mcm9tKFxuICAgICAgY3JlYXRlSGFzaChcInNoYTI1NlwiKS51cGRhdGUodGhpcy50b1N0cmluZygpKS5kaWdlc3QoXCJoZXhcIilcbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUFkZE1yRW5jbGF2ZVBheWxvYWQge1xuICB1c2VyX3B1YmtleTogc3RyaW5nO1xuICBjaXBoZXJzdWl0ZTogc3RyaW5nO1xuICBtcl9lbmNsYXZlOiBzdHJpbmc7XG4gIHNlY3JldF9uYW1lczogc3RyaW5nW107XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgQWRkTXJFbmNsYXZlUGF5bG9hZCBpbXBsZW1lbnRzIElBZGRNckVuY2xhdmVQYXlsb2FkIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKFxuICAgIHJlYWRvbmx5IHVzZXJfcHVia2V5OiBzdHJpbmcsXG4gICAgcmVhZG9ubHkgY2lwaGVyc3VpdGU6IHN0cmluZyxcbiAgICByZWFkb25seSBtcl9lbmNsYXZlOiBzdHJpbmcsXG4gICAgcmVhZG9ubHkgc2VjcmV0X25hbWVzOiBzdHJpbmdbXSxcbiAgICByZWFkb25seSB0aW1lc3RhbXA6IG51bWJlclxuICApIHt9XG5cbiAgcHVibGljIHN0YXRpYyBmcm9tKG9iajogSUFkZE1yRW5jbGF2ZVBheWxvYWQpOiBBZGRNckVuY2xhdmVQYXlsb2FkIHtcbiAgICByZXR1cm4gbmV3IEFkZE1yRW5jbGF2ZVBheWxvYWQoXG4gICAgICBvYmoudXNlcl9wdWJrZXksXG4gICAgICBvYmouY2lwaGVyc3VpdGUsXG4gICAgICBvYmoubXJfZW5jbGF2ZSxcbiAgICAgIG9iai5zZWNyZXRfbmFtZXMsXG4gICAgICBvYmoudGltZXN0YW1wXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyB0b0pTT04oKTogSUFkZE1yRW5jbGF2ZVBheWxvYWQge1xuICAgIHJldHVybiB7XG4gICAgICB1c2VyX3B1YmtleTogdGhpcy51c2VyX3B1YmtleSxcbiAgICAgIGNpcGhlcnN1aXRlOiB0aGlzLmNpcGhlcnN1aXRlLFxuICAgICAgbXJfZW5jbGF2ZTogdGhpcy5tcl9lbmNsYXZlLFxuICAgICAgc2VjcmV0X25hbWVzOiB0aGlzLnNlY3JldF9uYW1lcyxcbiAgICAgIHRpbWVzdGFtcDogdGhpcy50aW1lc3RhbXAsXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnRvSlNPTigpKTtcbiAgfVxuXG4gIHB1YmxpYyB0b0VuY29kZWRNZXNzYWdlKCk6IEJ1ZmZlciB7XG4gICAgcmV0dXJuIEJ1ZmZlci5mcm9tKFxuICAgICAgY3JlYXRlSGFzaChcInNoYTI1NlwiKS51cGRhdGUodGhpcy50b1N0cmluZygpKS5kaWdlc3QoXCJoZXhcIilcbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSVJlbW92ZU1yRW5jbGF2ZVBheWxvYWQge1xuICB1c2VyX3B1YmtleTogc3RyaW5nO1xuICBjaXBoZXJzdWl0ZTogc3RyaW5nO1xuICBtcl9lbmNsYXZlOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgUmVtb3ZlTXJFbmNsYXZlUGF5bG9hZCBpbXBsZW1lbnRzIElSZW1vdmVNckVuY2xhdmVQYXlsb2FkIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKFxuICAgIHJlYWRvbmx5IHVzZXJfcHVia2V5OiBzdHJpbmcsXG4gICAgcmVhZG9ubHkgY2lwaGVyc3VpdGU6IHN0cmluZyxcbiAgICByZWFkb25seSBtcl9lbmNsYXZlOiBzdHJpbmcsXG4gICAgcmVhZG9ubHkgdGltZXN0YW1wOiBudW1iZXJcbiAgKSB7fVxuXG4gIHB1YmxpYyBzdGF0aWMgZnJvbShvYmo6IElSZW1vdmVNckVuY2xhdmVQYXlsb2FkKTogUmVtb3ZlTXJFbmNsYXZlUGF5bG9hZCB7XG4gICAgcmV0dXJuIG5ldyBSZW1vdmVNckVuY2xhdmVQYXlsb2FkKFxuICAgICAgb2JqLnVzZXJfcHVia2V5LFxuICAgICAgb2JqLmNpcGhlcnN1aXRlLFxuICAgICAgb2JqLm1yX2VuY2xhdmUsXG4gICAgICBvYmoudGltZXN0YW1wXG4gICAgKTtcbiAgfVxuXG4gIHB1YmxpYyB0b0pTT04oKTogSVJlbW92ZU1yRW5jbGF2ZVBheWxvYWQge1xuICAgIHJldHVybiB7XG4gICAgICB1c2VyX3B1YmtleTogdGhpcy51c2VyX3B1YmtleSxcbiAgICAgIGNpcGhlcnN1aXRlOiB0aGlzLmNpcGhlcnN1aXRlLFxuICAgICAgbXJfZW5jbGF2ZTogdGhpcy5tcl9lbmNsYXZlLFxuICAgICAgdGltZXN0YW1wOiB0aGlzLnRpbWVzdGFtcCxcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCkpO1xuICB9XG5cbiAgcHVibGljIHRvRW5jb2RlZE1lc3NhZ2UoKTogQnVmZmVyIHtcbiAgICByZXR1cm4gQnVmZmVyLmZyb20oXG4gICAgICBjcmVhdGVIYXNoKFwic2hhMjU2XCIpLnVwZGF0ZSh0aGlzLnRvU3RyaW5nKCkpLmRpZ2VzdChcImhleFwiKVxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJRGVsZXRlU2VjcmV0UGF5bG9hZCB7XG4gIHVzZXJfcHVia2V5OiBzdHJpbmc7XG4gIGNpcGhlcnN1aXRlOiBzdHJpbmc7XG4gIHNlY3JldF9uYW1lOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgRGVsZXRlU2VjcmV0UGF5bG9hZCBpbXBsZW1lbnRzIElEZWxldGVTZWNyZXRQYXlsb2FkIHtcbiAgcHVibGljIGNvbnN0cnVjdG9yKFxuICAgIHJlYWRvbmx5IHVzZXJfcHVia2V5OiBzdHJpbmcsXG4gICAgcmVhZG9ubHkgY2lwaGVyc3VpdGU6IHN0cmluZyxcbiAgICByZWFkb25seSBzZWNyZXRfbmFtZTogc3RyaW5nLFxuICAgIHJlYWRvbmx5IHRpbWVzdGFtcDogbnVtYmVyXG4gICkge31cblxuICBwdWJsaWMgc3RhdGljIGZyb20ob2JqOiBJRGVsZXRlU2VjcmV0UGF5bG9hZCk6IERlbGV0ZVNlY3JldFBheWxvYWQge1xuICAgIHJldHVybiBuZXcgRGVsZXRlU2VjcmV0UGF5bG9hZChcbiAgICAgIG9iai51c2VyX3B1YmtleSxcbiAgICAgIG9iai5jaXBoZXJzdWl0ZSxcbiAgICAgIG9iai5zZWNyZXRfbmFtZSxcbiAgICAgIG9iai50aW1lc3RhbXBcbiAgICApO1xuICB9XG5cbiAgcHVibGljIHRvSlNPTigpOiBJRGVsZXRlU2VjcmV0UGF5bG9hZCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHVzZXJfcHVia2V5OiB0aGlzLnVzZXJfcHVia2V5LFxuICAgICAgY2lwaGVyc3VpdGU6IHRoaXMuY2lwaGVyc3VpdGUsXG4gICAgICBzZWNyZXRfbmFtZTogdGhpcy5zZWNyZXRfbmFtZSxcbiAgICAgIHRpbWVzdGFtcDogdGhpcy50aW1lc3RhbXAsXG4gICAgfTtcbiAgfVxuXG4gIHB1YmxpYyB0b1N0cmluZygpOiBzdHJpbmcge1xuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLnRvSlNPTigpKTtcbiAgfVxuXG4gIHB1YmxpYyB0b0VuY29kZWRNZXNzYWdlKCk6IEJ1ZmZlciB7XG4gICAgcmV0dXJuIEJ1ZmZlci5mcm9tKFxuICAgICAgY3JlYXRlSGFzaChcInNoYTI1NlwiKS51cGRhdGUodGhpcy50b1N0cmluZygpKS5kaWdlc3QoXCJoZXhcIilcbiAgICApO1xuICB9XG59XG4iXX0=